<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.557">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>arctraining slides</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="software-development-skills-for-research-computing" class="level2">
<h2 class="anchored" data-anchor-id="software-development-skills-for-research-computing">Software Development Skills for Research Computing</h2>
<p>During this course, you will:</p>
<ul>
<li>Learn to apply basic software development practices to improve your code</li>
<li>Get to grips with organising your code-base</li>
<li>Develop a blueprint for dealing with dependencies, conda environments, and code versions</li>
<li>Learn about various tools and resources you can implement in the future</li>
</ul>
</section>
<section id="software-development-skills-for-research-computing-1" class="level2">
<h2 class="anchored" data-anchor-id="software-development-skills-for-research-computing-1">Software Development Skills for Research Computing</h2>
<p>During this course, you will <strong>not</strong>:</p>
<ul>
<li>Learn <strong>best practice</strong> software development: we are going for a <em>good enough</em> approach as opposed to perfect, but can point you to resources if you want to learn more</li>
<li>Become a software developer overnight: it takes practise!</li>
<li>Learn the complicated mathematics behind your numerical models or statistical analysis, or how to implement these in Python</li>
</ul>
</section>
<section id="agenda" class="level2">
<h2 class="anchored" data-anchor-id="agenda">Agenda</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Start time</th>
<th>End time</th>
<th>Duration</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>10:00</strong></td>
<td><strong>10:50</strong></td>
<td><strong>50 min</strong></td>
<td><strong>Intro presentation</strong></td>
</tr>
<tr class="even">
<td>10:50</td>
<td>11:00</td>
<td><em>10 min</em></td>
<td><em>Short break</em></td>
</tr>
<tr class="odd">
<td><strong>11:00</strong></td>
<td><strong>12:00</strong></td>
<td><strong>60 min</strong></td>
<td><strong>Version control and project organisation</strong></td>
</tr>
<tr class="even">
<td>12:00</td>
<td>13:00</td>
<td><em>60 min</em></td>
<td><em>Lunch</em></td>
</tr>
<tr class="odd">
<td><strong>13:00</strong></td>
<td><strong>13:50</strong></td>
<td><strong>50 min</strong></td>
<td><strong>Testing and linting code</strong></td>
</tr>
<tr class="even">
<td>13:50</td>
<td>14:00</td>
<td><em>10 min</em></td>
<td><em>Short break</em></td>
</tr>
<tr class="odd">
<td><strong>14:00</strong></td>
<td><strong>14:45</strong></td>
<td><strong>45 min</strong></td>
<td><strong>Documentation and automated workflows</strong></td>
</tr>
<tr class="even">
<td>14:45</td>
<td>15:00</td>
<td><em>15 min</em></td>
<td><em>Short break</em></td>
</tr>
<tr class="odd">
<td><strong>15:00</strong></td>
<td><strong>15:45</strong></td>
<td><strong>45 min</strong></td>
<td><strong>Packaging and releases</strong></td>
</tr>
<tr class="even">
<td><strong>15:45</strong></td>
<td><strong>16:00</strong></td>
<td><strong>15 min</strong></td>
<td><strong>Questions, wrap-up</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="course-notes" class="level2">
<h2 class="anchored" data-anchor-id="course-notes">Course notes</h2>
<ul>
<li><a href="https://murphyqm.github.io/swd3-notes/" data-preview-link="true">Documentation and detailed notes</a></li>
<li><a href="https://derelict.streamlit.app/">DeReLiCT code</a> - the bare minimum to stop your code falling down</li>
<li><a href="https://package-your-python.streamlit.app/">Basic Python Project Structure</a> - interactive webapp to generate code snippets to set up your project</li>
</ul>
</section>
<section id="why-apply-software-dev-principles-to-your-coding" class="level2">
<h2 class="anchored" data-anchor-id="why-apply-software-dev-principles-to-your-coding">Why apply software dev principles to your coding?</h2>
<p>An example from my research: Electron Microprobe Analysis</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  subgraph lab[1. Lab analysis of samples]
    direction TB
    A[Primary Standards: known comp. - P1] --&gt; 
    B(Samples: unknown comp.) --&gt; 
    C[Primary Standards again: known comp. - P2]
  end
  lab -..-&gt; END[2. Instrument validation after data collection]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>Bracket samples with standards of known composition (published and trusted standards)</li>
</ul>
</section>
<section id="why-apply-software-dev-principles-to-your-coding-1" class="level2">
<h2 class="anchored" data-anchor-id="why-apply-software-dev-principles-to-your-coding-1">Why apply software dev principles to your coding?</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  subgraph inst[2. Instrument validation after data collection]
    direction LR
    D[/Do P1 and P2&lt;br&gt;match each other&lt;br&gt;within error?/]--&gt;|Yes| F
    D --&gt;|No| E
    E(Instrument drift)
    F[/Do P1 and P2 match&lt;br&gt;published values&lt;br&gt; within error?/]
    F --&gt;|No| G
    G(Calibration issue)
  end
  START[1. Lab analysis of samples] -.-&gt; inst
  F --&gt;|Yes| pos
  E --&gt; neg
  G --&gt; neg
  neg(fa:fa-ban Results not valid)
  pos(Results may be valid)
  pos --&gt; posnext[Test scientific&lt;br&gt;validity of results]
  neg -.-&gt; negnext[Check instrument settings&lt;br&gt;Rerun analyses]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>Compare standards to each other to see results are consistent over time</li>
<li>Compare standards to their published compositions
<ul>
<li>Well-established allowable error</li>
</ul></li>
</ul>
</section>
<section id="why-apply-software-dev-principles-to-your-coding-2" class="level2">
<h2 class="anchored" data-anchor-id="why-apply-software-dev-principles-to-your-coding-2">Why apply software dev principles to your coding?</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  subgraph lab[1. Lab analysis of samples]
    direction TB
    A[Primary Standards: known comp. - P1] --&gt; 
    B(Samples: unknown comp.) --&gt; 
    C[Primary Standards again: known comp. - P2]
  end
  subgraph inst[2. Instrument validation after data collection]
    direction LR
    D[/Do P1 and P2&lt;br&gt;match each other&lt;br&gt;within error?/]--&gt;|Yes| F
    D --&gt;|No| E
    E(Instrument drift)
    F[/Do P1 and P2 match&lt;br&gt;published values&lt;br&gt; within error?/]
    F --&gt;|No| G
    G(Calibration issue)
  end
  lab ---&gt; inst
  F --&gt;|Yes| pos
  E --&gt; neg
  G --&gt; neg
  neg(fa:fa-ban Results not valid)
  pos(Results may be valid)
  pos --&gt; posnext[Test scientific&lt;br&gt;validity of results]
  neg -.-&gt; negnext[Check instrument settings&lt;br&gt;Rerun analyses]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>Without the above documented steps, my results would not be publishable or considered in any way robust</li>
<li>How do we implement a similar workflow for computational research?
<ul>
<li>We treat code as a laboratory instrument!</li>
</ul></li>
</ul>
</section>
<section id="github-codespaces-and-devcontainers" class="level2">
<h2 class="anchored" data-anchor-id="github-codespaces-and-devcontainers">GitHub codespaces and devcontainers</h2>
<ul>
<li>Today, we are going to be using GitHub codespaces to run our code</li>
<li>This is essentially just a remote linux machine running in the cloud</li>
<li>You get restricted free access (120 hours per month) which is plenty for this course</li>
<li>When using what we’ve discussed for your own research, install everything locally</li>
<li>We have created a template repository for you to use</li>
</ul>
<blockquote class="blockquote">
<p>Make sure you have a GitHub account and know your login details!</p>
</blockquote>
</section>
<section id="version-control" class="level1">
<h1>Version Control</h1>
<section id="version-control-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="version-control-1">Version Control</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assets/img/git/phd101212s.png" class="img-fluid figure-img"></p>
<figcaption><a href="http://www.phdcomics.com">Piled Higher and Deeper by Jorge Cham</a></figcaption>
</figure>
</div>
</section>
<section id="version-control-2" class="level2">
<h2 class="anchored" data-anchor-id="version-control-2">Version Control</h2>
<ul>
<li>Manual: naming files <code>v1</code>, <code>v2</code>, etc.</li>
<li>Automated: using trackchanges on worddocs, overleaf etc.</li>
<li>Automated plain text: using SVN, <strong>git</strong> etc.</li>
</ul>
<p>We are going to use <a href="https://git-scm.com/"><code>git</code></a>:</p>
<ul>
<li>Free, open source</li>
<li>Simple, easy to learn</li>
<li>Fast</li>
<li>Very widely used within research community</li>
<li>Lots of tools built around it</li>
</ul>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<section id="git-workflow" class="level3">
<h3 class="anchored" data-anchor-id="git-workflow">git workflow</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">gitGraph
   commit id: "First commit"
   commit id: "Add README.md"
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>Make some change to file <code>README.md</code></li>
<li>Add the file: <code>git add README.md</code></li>
<li>Commit the file with a message: <code>git commit -m "My note goes here"</code></li>
</ul>
</section>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<section id="git-workflow-1" class="level3">
<h3 class="anchored" data-anchor-id="git-workflow-1">git workflow</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">gitGraph
   commit id: "First commit"
   commit id: "Add README.md"
   branch first-feature
   checkout first-feature
   commit id: "Adding code"
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>Create a new branch called <code>first-feature</code>: <code>git branch first-feature</code></li>
<li>Swap over to that branch: <code>git checkout first-feature</code></li>
<li>Then the usual add and commit: <code>git add .</code>, <code>git commit</code> -&gt; without the <code>-m</code> for message, this will open a text editor for you to add a message</li>
</ul>
</section>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
<section id="git-workflow-2" class="level3">
<h3 class="anchored" data-anchor-id="git-workflow-2">git workflow</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">gitGraph
   commit id: "First commit"
   commit id: "Add README.md"
   branch first-feature
   checkout first-feature
   commit id: "Adding code"
   commit
   commit
   checkout main
   merge first-feature id: "Tests pass"
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>After making a series of changes, we can run tests on our code</li>
<li>We can merge the changes back to the main branch if we are happy</li>
</ul>
</section>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3"></h2>
<section id="git-workflow-3" class="level3">
<h3 class="anchored" data-anchor-id="git-workflow-3">git workflow</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">gitGraph
   commit id: "First commit"
   commit id: "Add README.md"
   branch first-feature
   checkout first-feature
   commit id: "Adding code"
   commit
   commit
   checkout main
   merge first-feature id: "Tests pass"
   branch new-feature
   checkout new-feature
   commit
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4"></h2>
<section id="git-workflow-4" class="level3">
<h3 class="anchored" data-anchor-id="git-workflow-4">git workflow</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">gitGraph
   commit id: "First commit"
   commit id: "Add README.md"
   branch first-feature
   checkout first-feature
   commit id: "Adding code"
   commit
   commit
   checkout main
   merge first-feature id: "Tests pass"
   branch new-feature
   checkout new-feature
   commit
   commit id: "Tests fail!" type:REVERSE
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5"></h2>
<section id="git-workflow-5" class="level3">
<h3 class="anchored" data-anchor-id="git-workflow-5">git workflow</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">gitGraph
   commit id: "First commit"
   commit id: "Add README.md"
   branch first-feature
   checkout first-feature
   commit id: "Adding code"
   commit
   commit
   checkout main
   merge first-feature id: "Tests pass"
   branch new-feature
   checkout new-feature
   commit
   commit id: "Tests fail!" type:REVERSE
   checkout main
   branch new-feature-02
   commit
   commit
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>
<section id="section-6" class="level2">
<h2 class="anchored" data-anchor-id="section-6"></h2>
<section id="git-workflow-6" class="level3">
<h3 class="anchored" data-anchor-id="git-workflow-6">git workflow</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">gitGraph
   commit id: "First commit"
   commit id: "Add README.md"
   branch first-feature
   checkout first-feature
   commit id: "Adding code"
   commit
   commit
   checkout main
   merge first-feature id: "Tests pass"
   branch new-feature
   checkout new-feature
   commit
   commit id: "Tests fail!" type:REVERSE
   checkout main
   branch new-feature-02
   commit
   commit
   checkout main
   merge new-feature-02 id: "Tests pass still"
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>
<section id="version-control-3" class="level2">
<h2 class="anchored" data-anchor-id="version-control-3">Version control</h2>
<section id="essential-git-commands" class="level3">
<h3 class="anchored" data-anchor-id="essential-git-commands">Essential git commands</h3>
<p>We will implement these later!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> status <span class="co"># check on status of current git repo</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> branch NAME <span class="co"># create a branch called NAME</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> checkout NAME <span class="co"># swap over to the branch called NAME</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add . <span class="co"># stage all changed files for commit, you can replace "." with FILE to add a single file called FILE</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="co"># commit the staged files (this will open your text editor to create a commit message)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin NAME <span class="co"># push local commits to the remote branch tracking the branch NAME</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="version-control-4" class="level2">
<h2 class="anchored" data-anchor-id="version-control-4">Version control</h2>
<ul>
<li>All your files and the git history will be stored in a public repository on GitHub</li>
<li>Transparency, easy to see your process, useful for reviewing code</li>
<li>Don’t worry about your “messy workings” being visible - it’s part of the scientific process</li>
</ul>
</section>
</section>
<section id="project-organisation" class="level1">
<h1>Project Organisation</h1>
<section id="project-organisation-1" class="level2">
<h2 class="anchored" data-anchor-id="project-organisation-1">Project organisation</h2>
<p>What does your project currently look like?</p>
<ul>
<li>Lots of Python scripts in different folders?</li>
<li>Very long, convoluted Python files?</li>
<li>Tests?</li>
<li>Comments?</li>
</ul>
<p>How do you share your Python work?</p>
<p>How do you record what version of each script you used?</p>
<p>How do you transfer your work to the HPC system and back?</p>
</section>
<section id="basic-structure-suggestion" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="basic-structure-suggestion">Basic Structure Suggestion</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The most basic structure for a code project should look like:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">my-package</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> pyproject.toml</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> src                <span class="op">&lt;</span>- Source code for this project</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> tests              <span class="op">&lt;</span>- Test code for this project</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Source Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Readme</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">pyproject.toml</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">tests</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ul>
<li>Your python code, including an <code>__init__.py</code> file to turn it into a package</li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<ul>
<li>This is a guide that gives users a detailed description of the contents of the repository: in this case, your Python package</li>
<li>It is the first file a person will see when they encounter your project, so it should be succinct</li>
<li>See how to write a good README file in this <a href="https://www.freecodecamp.org/news/how-to-write-a-good-readme-file/"><code>freecodecamp</code> post</a>.</li>
</ul>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<ul>
<li>Text information about all the necessary additional libraries, the structure of the project, your name etc.</li>
<li>Allows you to install the code in <code>src/</code> as a Python package to use elsewhere on your system</li>
<li>Find out more about the format of the <a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/#creating-pyproject-toml"><code>pyproject.toml</code></a> file</li>
<li>This can be replaced by/supplemented by files like: <a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-from-an-environment-yml-file"><code>environment.yml</code></a>, <a href="https://www.pythonforthelab.com/blog/how-create-setup-file-your-project/"><code>setup.py</code></a>.</li>
</ul>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<ul>
<li>This folder contains tests that run small sections of your code with known expected results</li>
<li>All tests units (files and methods) must be named starting with <code>test_</code> and placed inside a directory called <code>tests</code>.</li>
<li>Tests can be grouped in just one folder for the entire repository or they can be organized within each package/subpackage.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="two-directory-structure" class="level2">
<h2 class="anchored" data-anchor-id="two-directory-structure">Two directory structure</h2>
<ul>
<li>I keep my large-scale code development separate from my scientific output</li>
<li>For example, I want to analyse the thermal evolution of a planet for a scientific papers
<ul>
<li>I build a numerical model of the heating and cooling of the planet</li>
<li>I use this model to test a range of parameters and compare to various datasets</li>
</ul></li>
<li>I might be able to reuse my numerical model in other situations so want to keep this separate</li>
<li>I know that my research process involves lots of exploratory plotting and analysis, which produces lots of scripts, and I don’t want these to get mixed up with my model code</li>
</ul>
</section>
<section id="repository-1-the-numerical-model-as-a-python-package" class="level2">
<h2 class="anchored" data-anchor-id="repository-1-the-numerical-model-as-a-python-package">Repository 1: the numerical model as a Python package</h2>
<pre class="text"><code>planet-evolution/            The package git repository
├── src/  
│   └── planet_evolution/     
│       ├── __init__.py      Makes the folder a package.
│       └── source.py        An example module containing source code.
├── tests/
|   ├── __init__.py          Sets up the test suite.
│   └── test_source.py       A file containing tests for the code in source.py.
├── README.md                README with information about the project.
├── docs                     Package documentation
├── pyproject.toml           Allows me to install this as a package
├── LICENSE                  License text to allow for reuse
└── CITATION.cff             Citation file that makes it easy for people to cite you!</code></pre>
<p>This model can be installed as a package, cited in your research, and reused in a later project.</p>
</section>
<section id="repository-2-my-scientific-analysis" class="level2">
<h2 class="anchored" data-anchor-id="repository-2-my-scientific-analysis">Repository 2: my scientific analysis</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pallasite-parent-body-evolution/</span>    The project git repository</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> LICENSE</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> env.yml or requirements.txt     The libraries I need for analysis <span class="er">(</span><span class="ex">including</span> planet_evolution!<span class="kw">)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> data                            I usually load in large data from storage elsewhere</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── interim                     But sometimes do keep small summary datafiles in the repository</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── processed</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── raw</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> docs                            Notes on analysis, process etc.</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> notebooks                       Jupyter notebooks used for analysis</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> reports                         For a manuscript source, e.g., LaTeX, Markdown, etc., or any project reports</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span> └── figures                     Figures for the manuscript or reports</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> src                             Source code for this project</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── data                        Scripts and programs to process data</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── tools                       Any helper scripts go here</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── visualization               Scripts for visualisation of your results, e.g., matplotlib, ggplot2 related.</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> tests                           Test code for this project, benchmarking, comparison to analytical models</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 50%;">
<p>This is the actual work for the scientific project - while others are unlikely to use this code as-is, it’s public and citeable so that you can point to a specific version in your published paper and readers can reproduce your work with it if they wish.</p>
<p>Adapted/modified from <a href="https://github.com/mkrapp/cookiecutter-reproducible-science">mkrapp/cookiecutter-reproducible-science github</a></p>
</div>
</section>
<section id="advanced-project-structure" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="advanced-project-structure">Advanced Project Structure</h2>
<p>Template based on <a href="https://github.com/mkrapp/cookiecutter-reproducible-science">mkrapp/cookiecutter-reproducible-science github</a></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> AUTHORS.md</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> LICENSE</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> bin                <span class="op">&lt;</span>- Your compiled model code can be stored here <span class="er">(</span><span class="ex">not</span> tracked by git<span class="kw">)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> config             <span class="op">&lt;</span>- Configuration files, e.g., for doxygen or for your model if needed</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> data</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── external       <span class="op">&lt;</span>- Data from third party sources.</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── interim        <span class="op">&lt;</span>- Intermediate data that has been transformed.</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── processed      <span class="op">&lt;</span>- The final, canonical data sets for modeling.</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── raw            <span class="op">&lt;</span>- The original, immutable data dump.</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> docs               <span class="op">&lt;</span>- Documentation, e.g., doxygen or scientific papers <span class="er">(</span><span class="ex">not</span> tracked by git<span class="kw">)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> notebooks          <span class="op">&lt;</span>- Ipython or R notebooks</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> reports            <span class="op">&lt;</span>- For a manuscript source, e.g., LaTeX, Markdown, etc., or any project reports</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span> └── figures        <span class="op">&lt;</span>- Figures for the manuscript or reports</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> src                <span class="op">&lt;</span>- Source code for this project</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── data           <span class="op">&lt;</span>- scripts and programs to process data</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── external       <span class="op">&lt;</span>- Any external source code, e.g., pull other git projects, or external libraries</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── models         <span class="op">&lt;</span>- Source code for your own model</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── tools          <span class="op">&lt;</span>- Any helper scripts go here</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── visualization  <span class="op">&lt;</span>- Scripts for visualisation of your results, e.g., matplotlib, ggplot2 related.</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> tests              <span class="op">&lt;</span>- Test code for this project</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="testing-code" class="level1">
<h1>Testing code</h1>
<section id="testing-code-1" class="level2">
<h2 class="anchored" data-anchor-id="testing-code-1">Testing code</h2>
<p>Remember our example of using known standards to check the instruments in the lab?</p>
<p>This is the equivalent for computational work!</p>
<ul>
<li>Tests ensure that your code runs in the way it’s intended to</li>
<li>Tests will flag if any changes you made either
<ul>
<li>Produce an error or break the code</li>
<li>“Silently” introduce errors - the code still runs, but the output is different</li>
</ul></li>
</ul>
</section>
<section id="testing-code-2" class="level2">
<h2 class="anchored" data-anchor-id="testing-code-2">Testing code</h2>
<div style="font-size: 50%;">
<blockquote class="blockquote">
<p>The good news is, you’ve probably already created a test without realizing it. Remember when you ran your application and used it for the first time? Did you check the features and experiment using them? That’s known as exploratory testing and is a form of manual testing.</p>
<p>Exploratory testing is a form of testing that is done without a plan. In an exploratory test, you’re just exploring the application.</p>
<p>To have a complete set of manual tests, all you need to do is make a list of all the features your application has, the different types of input it can accept, and the expected results. Now, every time you make a change to your code, you need to go through every single item on that list and check it.</p>
<p>That doesn’t sound like much fun, does it?</p>
</blockquote>
<p>From <a href="https://realpython.com/python-testing/">RealPython: Getting Started With Testing in Python</a></p>
</div>
<p>Lots and lots of great accessible resources for learning about this and implementing this:</p>
<ul>
<li><a href="https://docs.python-guide.org/writing/tests/">Hitchiker’s Guide to Python: Testing your code</a></li>
<li><a href="https://machinelearningmastery.com/a-gentle-introduction-to-unit-testing-in-python/">A gentle introduction to Unit Testing in Python</a></li>
<li><a href="https://realpython.com/python-testing/">RealPython: Getting Started With Testing in Python</a></li>
</ul>
</section>
<section id="testing-code-3" class="level2">
<h2 class="anchored" data-anchor-id="testing-code-3">Testing code</h2>
<p>Python tests generally rely on <code>assert</code> statements or similar, where the test passes <code>if</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>package_function_output <span class="op">==</span> expected_example_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 50%;">
<p>N.B. rarely in scientific applications can we use <code>==</code> as we are often dealing with floats and some degree of error; we will discuss the various alternatives that allow tolerances during the testing session.</p>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Unit Tests</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Integration Tests</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<ul>
<li>Tests each individual little piece of code</li>
<li>Each function in your project should have a unit test</li>
<li>Tests edgecases</li>
</ul>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<ul>
<li>Tests how the package works together as a whole</li>
<li>Tests various combinations of functions</li>
<li>Tests the full workflow you use for research</li>
</ul>
</div>
</div>
</div>
</section>
<section id="testing-your-science" class="level2">
<h2 class="anchored" data-anchor-id="testing-your-science">Testing your science</h2>
<p>This is often where tutorials stop when it comes to code testing: but you also need to scientifically validate your code!</p>
<ul>
<li>Unit Testing and Integration Testing test that the code is functional, it does not check for scientific validity</li>
<li>Depending on your area/the code you are writing, you might need to test for:
<ul>
<li>Numerical precision and accuracy</li>
<li>Stability</li>
<li>Agreement with previous numerical models/analytical solutions*</li>
<li>Scientific sense: does the answer make physical sense? (Does the thing cool down when you expect it to? Does time run forwards?)</li>
</ul></li>
</ul>
<div style="font-size: 50%;">
<p>There are other problems with the circle of purely validating numerical models against other numerical models… but that is too long a debate for today!</p>
</div>
</section>
<section id="testing-your-science-1" class="level2">
<h2 class="anchored" data-anchor-id="testing-your-science-1">Testing your science</h2>
<ul>
<li>In our two-repository set up, tests for science can be split across both:
<ul>
<li>Some tests will always need to be true (the model should <em>always</em> be cooling, gravitational acceleration should <em>always</em> be &gt;20 ms^-2 on a giant planet etc.)</li>
<li>Some tests will be specific to your application for a scientific output and can live in that second repository</li>
</ul></li>
</ul>
<div style="font-size: 50%;">
<ul>
<li>There are other problems with the circle of purely validating numerical models against other numerical models… but that is too long a debate for today!</li>
</ul>
</div>
</section>
</section>
<section id="linting-and-formatting-code" class="level1">
<h1>Linting and Formatting code</h1>
<section id="coding-conventions" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="coding-conventions">Coding conventions</h2>
<p>If your language or project has a standard policy, use that. For example:</p>
<ul>
<li>Python: <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a></li>
<li>R: <a href="https://google.github.io/styleguide/Rguide.xml">Google’s guide for R</a>, <a href="https://style.tidyverse.org/">tidyverse style guide</a></li>
<li>C++: <a href="https://google.github.io/styleguide/cppguide.html">Google’s style guide</a></li>
<li>Julia: <a href="https://docs.julialang.org/en/v1/manual/style-guide/index.html">Official style guide</a></li>
</ul>
</section>
<section id="linters" class="level2">
<h2 class="anchored" data-anchor-id="linters">Linters</h2>
<p>Linters are automated tools which enforce coding conventions and check for common mistakes. For example:</p>
<ul>
<li>Python:
<ul>
<li><a href="https://flake8.pycqa.org/en/latest/index.html">flake8</a> (flags any syntax/style errors)</li>
<li><a href="https://black.readthedocs.io/">black</a> (enforces the style)</li>
<li><a href="https://pycqa.github.io/isort/">isort</a> (“Sorts” imports alphabetically in groups)</li>
</ul></li>
</ul>
</section>
<section id="example-flake8-linter" class="level2">
<h2 class="anchored" data-anchor-id="example-flake8-linter">Example: Flake8 Linter</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> conda install flake8</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> flake8 myscript.py</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:2:6:</span> E201 whitespace after <span class="st">'{'</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:2:11:</span> E231 missing whitespace after <span class="st">':'</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:2:14:</span> E231 missing whitespace after <span class="st">','</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:2:18:</span> E231 missing whitespace after <span class="st">':'</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:3:1:</span> E128 continuation line under-indented for visual indent</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:3:4:</span> E231 missing whitespace after <span class="st">':'</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:4:13:</span> E225 missing whitespace around operator</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:4:14:</span> E222 multiple spaces after operator</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:5:1:</span> E302 expected 2 blank lines, found 0</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:5:13:</span> E201 whitespace after <span class="st">'('</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:5:25:</span> E202 whitespace before <span class="st">')'</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:6:4:</span> E111 indentation is not a multiple of 4</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:6:9:</span> E211 whitespace before <span class="st">'('</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:6:20:</span> E202 whitespace before <span class="st">')'</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:7:8:</span> E111 indentation is not a multiple of 4</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:7:14:</span> E271 multiple spaces after keyword</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:7:25:</span> E225 missing whitespace around operator</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:8:4:</span> E301 expected 1 blank line, found 0</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:8:4:</span> E111 indentation is not a multiple of 4</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:8:17:</span> E203 whitespace before <span class="st">':'</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:8:18:</span> E231 missing whitespace after <span class="st">':'</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:9:8:</span> E128 continuation line under-indented for visual indent</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:9:9:</span> E203 whitespace before <span class="st">':'</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:9:15:</span> E252 missing whitespace around parameter equals</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:9:16:</span> E252 missing whitespace around parameter equals</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:10:8:</span> E124 closing bracket does not match visual indentation</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:10:8:</span> E125 continuation line with same indent as next logical line</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:11:8:</span> E111 indentation is not a multiple of 4</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:12:1:</span> E302 expected 2 blank lines, found 0</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:12:6:</span> E211 whitespace before <span class="st">'('</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:12:9:</span> E201 whitespace after <span class="st">'('</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:12:13:</span> E202 whitespace before <span class="st">')'</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:12:15:</span> E203 whitespace before <span class="st">':'</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:13:4:</span> E111 indentation is not a multiple of 4</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:13:10:</span> E271 multiple spaces after keyword</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:13:26:</span> E203 whitespace before <span class="st">':'</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="ex">myscript.py:13:34:</span> W291 trailing whitespace</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="linters-and-formatters" class="level2">
<h2 class="anchored" data-anchor-id="linters-and-formatters">Linters and Formatters</h2>
<ul>
<li>This is the equivalent of spellchecker for your code</li>
<li>Do yourself a favour and ensure whatever IDE you are using has this enabled!</li>
<li>I prefer having the linter run while you code, rather than running after, but this is personal preference</li>
<li>Many different tools available, we will have some preloaded in our devcontainer</li>
</ul>
<p>You can see what the Black code formatter will do to your code here:</p>
<ul>
<li><a href="https://black.vercel.app/" data-preview-link="true">Black formatter</a></li>
</ul>
</section>
</section>
<section id="dependencies-and-virtual-environments" class="level1">
<h1>Dependencies and Virtual Environments</h1>
<section id="virtual-environments" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="virtual-environments">Virtual Environments</h2>
<p>If application A needs version 1.0 of a particular module but application B needs version 2.0, then the requirements are in conflict and installing either version 1.0 or 2.0 will leave one application unable to run.</p>
<p>The solution for this problem is to create a virtual environment, a self-contained directory tree that contains installation for particular versions of software/packages.</p>
<section id="conda" class="level3">
<h3 class="anchored" data-anchor-id="conda">Conda</h3>
<ul>
<li><a href="https://docs.conda.io/en/latest/">Conda</a> is an open source package management system and environment management system that runs on Windows, macOS, and Linux.</li>
<li>It offers dependency and environment management for any language—Python, R, Ruby, Lua, Scala, Java, JavaScript, C/ C++, Fortran, and more.</li>
<li>Easy user install via <a href="https://www.anaconda.com/download">Anaconda</a>.</li>
<li>We will be using the minimal <a href="https://github.com/conda-forge/miniforge/blob/main/README.md">MiniForge installation</a> in our devcontainer</li>
</ul>
</section>
</section>
</section>
<section id="documentation" class="level1">
<h1>Documentation</h1>
<section id="commenting-your-code" class="level2">
<h2 class="anchored" data-anchor-id="commenting-your-code">Commenting your code</h2>
<ul>
<li>The most basic version of documentation is ensuring that your code is well-commented</li>
<li>This helps make sure you know what’s happening in your code</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comments should be short, sweet, and to the point</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>constant <span class="op">=</span> <span class="fl">1.5</span>  <span class="co"># Comments can be inline too</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Comments should add additional context, can contain links</li>
<li>Don’t add comments for the sake of commenting</li>
</ul>
</section>
<section id="commenting-your-code-1" class="level2">
<h2 class="anchored" data-anchor-id="commenting-your-code-1">Commenting your code</h2>
<ul>
<li>Comments to yourself can also help you to outline and plan your code</li>
<li>You can write pseudocode in comments to help plan functions</li>
</ul>
<p>See this example from <a href="https://realpython.com/python-comments-guide/">RealPython</a>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_cities(prices):</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    top_cities <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each price range</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get city searches in that price</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Count num times city was searched</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Take top 3 cities &amp; add to dict</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">dict</span>(top_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="commenting-for-others" class="level2">
<h2 class="anchored" data-anchor-id="commenting-for-others">Commenting for others</h2>
<p>In later iterations of your code you might want to clean up your comments to yourself and formalise your documentation more</p>
<ul>
<li>In functions, you should add a <a href="https://peps.python.org/pep-0257/#one-line-docstrings">docstring</a></li>
</ul>
<p>Here’s an example of a single-line docstring from the <a href="https://peps.python.org/pep-0257/#one-line-docstrings">PEP 257 docstring guidelines</a></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kos_root():</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Return the pathname of the KOS root directory."""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> _kos_root</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> _kos_root: <span class="cf">return</span> _kos_root</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section-7" class="level2">
<h2 class="anchored" data-anchor-id="section-7"></h2>
<p>Docstrings can be <a href="https://peps.python.org/pep-0257/#multi-line-docstrings">multiline</a> too:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="bu">complex</span>(real<span class="op">=</span><span class="fl">0.0</span>, imag<span class="op">=</span><span class="fl">0.0</span>):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Form a complex number.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Keyword arguments:</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">    real -- the real part (default 0.0)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">    imag -- the imaginary part (default 0.0)</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> imag <span class="op">==</span> <span class="fl">0.0</span> <span class="kw">and</span> real <span class="op">==</span> <span class="fl">0.0</span>:</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> complex_zero</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="releases-on-github" class="level1">
<h1>Releases on GitHub</h1>
<section id="releases" class="level2">
<h2 class="anchored" data-anchor-id="releases">Releases</h2>
<blockquote class="blockquote">
<p><a href="https://docs.github.com/en/repositories/releasing-projects-on-github/about-releases#about-releases">Releases</a> are deployable software iterations you can package and make available for a wider audience to download and use.</p>
</blockquote>
<ul>
<li><p>A release takes a snapshot of your entire repository at a specific time, bundles it all into a zipped file, and stamps it with a version number (like v1.2.0), making it easy for you to reference the exact version of your code you used for a scientific project</p></li>
<li><p>You can link your GitHub repository to Zenodo and get a DOI for your releases</p></li>
<li><p><a href="https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository#creating-a-release" data-preview-link="true">Creating a release on GitHub</a></p></li>
</ul>
</section>
</section>
<section id="working-with-an-old-project" class="level1">
<h1>Working with an old project</h1>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8"></h2>
<p>You probably already have multiple different projects in progress, and don’t have the time or capacity to go back and organise everything as we’ve explained.</p>
<p>What can you do when faced with an overwhelmingly messy codebase?</p>
<p>Apply the DeReLiCT acronym:</p>
<ul>
<li>Dependencies</li>
<li>Repository</li>
<li>License</li>
<li>Citation</li>
<li>Testing</li>
</ul>
<p>Learn more <a href="https://derelict.streamlit.app/">here</a>.</p>
</section>
<section id="agenda-1" class="level2">
<h2 class="anchored" data-anchor-id="agenda-1">Agenda</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Start time</th>
<th>End time</th>
<th>Duration</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>10:00</strong></td>
<td><strong>10:50</strong></td>
<td><strong>50 min</strong></td>
<td><strong>Intro presentation</strong></td>
</tr>
<tr class="even">
<td>10:50</td>
<td>11:00</td>
<td><em>10 min</em></td>
<td><em>Short break</em></td>
</tr>
<tr class="odd">
<td><strong>11:00</strong></td>
<td><strong>12:00</strong></td>
<td><strong>60 min</strong></td>
<td><strong>Version control and project organisation</strong></td>
</tr>
<tr class="even">
<td>12:00</td>
<td>13:00</td>
<td><em>60 min</em></td>
<td><em>Lunch</em></td>
</tr>
<tr class="odd">
<td><strong>13:00</strong></td>
<td><strong>13:50</strong></td>
<td><strong>50 min</strong></td>
<td><strong>Testing and linting code</strong></td>
</tr>
<tr class="even">
<td>13:50</td>
<td>14:00</td>
<td><em>10 min</em></td>
<td><em>Short break</em></td>
</tr>
<tr class="odd">
<td><strong>14:00</strong></td>
<td><strong>14:45</strong></td>
<td><strong>45 min</strong></td>
<td><strong>Documentation and automated workflows</strong></td>
</tr>
<tr class="even">
<td>14:45</td>
<td>15:00</td>
<td><em>15 min</em></td>
<td><em>Short break</em></td>
</tr>
<tr class="odd">
<td><strong>15:00</strong></td>
<td><strong>15:45</strong></td>
<td><strong>45 min</strong></td>
<td><strong>Packaging and releases</strong></td>
</tr>
<tr class="even">
<td><strong>15:45</strong></td>
<td><strong>16:00</strong></td>
<td><strong>15 min</strong></td>
<td><strong>Questions, wrap-up</strong></td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ARCTraining\.github\.io\/rc-slides");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>